#include "../../src/convert.hpp"
#include "../../src/normalise.hpp"
#include <gtest/gtest.h>
#include <string>
#include <vector>

TEST(normalise, normpath) {
    GTEST_SKIP();

    struct TestCase {
        std::string path;
        std::string expected;
    };

    std::vector<TestCase> cases = {
        {"",            "."          },
        {".",           "."          },
        {"..",          ".."         },
        {"a",           "a"          },
        {"/",           "/"          },
        {"/.",          "/"          },
        {"/..",         "/"          },
        {"/a",          "/a"         },
        {"./",          "."          },
        {"./.",         "."          },
        {"./..",        ".."         },
        {"./a",         "a"          },
        {"../",         ".."         },
        {"../.",        ".."         },
        {"../..",       "../.."      },
        {"../a",        "../a"       },
        {"a/",          "a"          },
        {"a/.",         "a"          },
        {"a/..",        "."          },
        {"a/b",         "a/b"        },
        {"//",          "//"         },
        {"//.",         "//"         },
        {"//..",        "//"         },
        {"//a",         "//a"        },
        {"/./",         "/"          },
        {"/./.",        "/"          },
        {"/./..",       "/"          },
        {"/./a",        "/a"         },
        {"/../",        "/"          },
        {"/../.",       "/"          },
        {"/../..",      "/"          },
        {"/../a",       "/a"         },
        {"/a/",         "/a"         },
        {"/a/.",        "/a"         },
        {"/a/..",       "/"          },
        {"/a/b",        "/a/b"       },
        {".//",         "."          },
        {".//.",        "."          },
        {".//..",       ".."         },
        {".//a",        "a"          },
        {"././",        "."          },
        {"././.",       "."          },
        {"././..",      ".."         },
        {"././a",       "a"          },
        {"./../",       ".."         },
        {"./../.",      ".."         },
        {"./../..",     "../.."      },
        {"./../a",      "../a"       },
        {"./a/",        "a"          },
        {"./a/.",       "a"          },
        {"./a/..",      "."          },
        {"./a/b",       "a/b"        },
        {"..//",        ".."         },
        {"..//.",       ".."         },
        {"..//..",      "../.."      },
        {"..//a",       "../a"       },
        {".././",       ".."         },
        {".././.",      ".."         },
        {".././..",     "../.."      },
        {".././a",      "../a"       },
        {"../../",      "../.."      },
        {"../../.",     "../.."      },
        {"../../..",    "../../.."   },
        {"../../a",     "../../a"    },
        {"../a/",       "../a"       },
        {"../a/.",      "../a"       },
        {"../a/..",     ".."         },
        {"../a/b",      "../a/b"     },
        {"a//",         "a"          },
        {"a//.",        "a"          },
        {"a//..",       "."          },
        {"a//b",        "a/b"        },
        {"a/./",        "a"          },
        {"a/./.",       "a"          },
        {"a/./..",      "."          },
        {"a/./b",       "a/b"        },
        {"a/../",       "."          },
        {"a/../.",      "."          },
        {"a/../..",     ".."         },
        {"a/../b",      "b"          },
        {"a/b/",        "a/b"        },
        {"a/b/.",       "a/b"        },
        {"a/b/..",      "a"          },
        {"a/b/c",       "a/b/c"      },
        {"///",         "/"          },
        {"///.",        "/"          },
        {"///..",       "/"          },
        {"///a",        "/a"         },
        {"//./",        "//"         },
        {"//./.",       "//"         },
        {"//./..",      "//"         },
        {"//./a",       "//a"        },
        {"//../",       "//"         },
        {"//../.",      "//"         },
        {"//../..",     "//"         },
        {"//../a",      "//a"        },
        {"//a/",        "//a"        },
        {"//a/.",       "//a"        },
        {"//a/..",      "//"         },
        {"//a/b",       "//a/b"      },
        {"/.//",        "/"          },
        {"/.//.",       "/"          },
        {"/.//..",      "/"          },
        {"/.//a",       "/a"         },
        {"/././",       "/"          },
        {"/././.",      "/"          },
        {"/././..",     "/"          },
        {"/././a",      "/a"         },
        {"/./../",      "/"          },
        {"/./../.",     "/"          },
        {"/./../..",    "/"          },
        {"/./../a",     "/a"         },
        {"/./a/",       "/a"         },
        {"/./a/.",      "/a"         },
        {"/./a/..",     "/"          },
        {"/./a/b",      "/a/b"       },
        {"/..//",       "/"          },
        {"/..//.",      "/"          },
        {"/..//..",     "/"          },
        {"/..//a",      "/a"         },
        {"/.././",      "/"          },
        {"/.././.",     "/"          },
        {"/.././..",    "/"          },
        {"/.././a",     "/a"         },
        {"/../../",     "/"          },
        {"/../../.",    "/"          },
        {"/../../..",   "/"          },
        {"/../../a",    "/a"         },
        {"/../a/",      "/a"         },
        {"/../a/.",     "/a"         },
        {"/../a/..",    "/"          },
        {"/../a/b",     "/a/b"       },
        {"/a//",        "/a"         },
        {"/a//.",       "/a"         },
        {"/a//..",      "/"          },
        {"/a//b",       "/a/b"       },
        {"/a/./",       "/a"         },
        {"/a/./.",      "/a"         },
        {"/a/./..",     "/"          },
        {"/a/./b",      "/a/b"       },
        {"/a/../",      "/"          },
        {"/a/../.",     "/"          },
        {"/a/../..",    "/"          },
        {"/a/../b",     "/b"         },
        {"/a/b/",       "/a/b"       },
        {"/a/b/.",      "/a/b"       },
        {"/a/b/..",     "/a"         },
        {"/a/b/c",      "/a/b/c"     },
        {".///",        "."          },
        {".///.",       "."          },
        {".///..",      ".."         },
        {".///a",       "a"          },
        {".//./",       "."          },
        {".//./.",      "."          },
        {".//./..",     ".."         },
        {".//./a",      "a"          },
        {".//../",      ".."         },
        {".//../.",     ".."         },
        {".//../..",    "../.."      },
        {".//../a",     "../a"       },
        {".//a/",       "a"          },
        {".//a/.",      "a"          },
        {".//a/..",     "."          },
        {".//a/b",      "a/b"        },
        {"././/",       "."          },
        {"././/.",      "."          },
        {"././/..",     ".."         },
        {"././/a",      "a"          },
        {"./././",      "."          },
        {"./././.",     "."          },
        {"./././..",    ".."         },
        {"./././a",     "a"          },
        {"././../",     ".."         },
        {"././../.",    ".."         },
        {"././../..",   "../.."      },
        {"././../a",    "../a"       },
        {"././a/",      "a"          },
        {"././a/.",     "a"          },
        {"././a/..",    "."          },
        {"././a/b",     "a/b"        },
        {"./..//",      ".."         },
        {"./..//.",     ".."         },
        {"./..//..",    "../.."      },
        {"./..//a",     "../a"       },
        {"./.././",     ".."         },
        {"./.././.",    ".."         },
        {"./.././..",   "../.."      },
        {"./.././a",    "../a"       },
        {"./../../",    "../.."      },
        {"./../../.",   "../.."      },
        {"./../../..",  "../../.."   },
        {"./../../a",   "../../a"    },
        {"./../a/",     "../a"       },
        {"./../a/.",    "../a"       },
        {"./../a/..",   ".."         },
        {"./../a/b",    "../a/b"     },
        {"./a//",       "a"          },
        {"./a//.",      "a"          },
        {"./a//..",     "."          },
        {"./a//b",      "a/b"        },
        {"./a/./",      "a"          },
        {"./a/./.",     "a"          },
        {"./a/./..",    "."          },
        {"./a/./b",     "a/b"        },
        {"./a/../",     "."          },
        {"./a/../.",    "."          },
        {"./a/../..",   ".."         },
        {"./a/../b",    "b"          },
        {"./a/b/",      "a/b"        },
        {"./a/b/.",     "a/b"        },
        {"./a/b/..",    "a"          },
        {"./a/b/c",     "a/b/c"      },
        {"..///",       ".."         },
        {"..///.",      ".."         },
        {"..///..",     "../.."      },
        {"..///a",      "../a"       },
        {"..//./",      ".."         },
        {"..//./.",     ".."         },
        {"..//./..",    "../.."      },
        {"..//./a",     "../a"       },
        {"..//../",     "../.."      },
        {"..//../.",    "../.."      },
        {"..//../..",   "../../.."   },
        {"..//../a",    "../../a"    },
        {"..//a/",      "../a"       },
        {"..//a/.",     "../a"       },
        {"..//a/..",    ".."         },
        {"..//a/b",     "../a/b"     },
        {".././/",      ".."         },
        {".././/.",     ".."         },
        {".././/..",    "../.."      },
        {".././/a",     "../a"       },
        {"../././",     ".."         },
        {"../././.",    ".."         },
        {"../././..",   "../.."      },
        {"../././a",    "../a"       },
        {".././../",    "../.."      },
        {".././../.",   "../.."      },
        {".././../..",  "../../.."   },
        {".././../a",   "../../a"    },
        {".././a/",     "../a"       },
        {".././a/.",    "../a"       },
        {".././a/..",   ".."         },
        {".././a/b",    "../a/b"     },
        {"../..//",     "../.."      },
        {"../..//.",    "../.."      },
        {"../..//..",   "../../.."   },
        {"../..//a",    "../../a"    },
        {"../.././",    "../.."      },
        {"../.././.",   "../.."      },
        {"../.././..",  "../../.."   },
        {"../.././a",   "../../a"    },
        {"../../../",   "../../.."   },
        {"../../../.",  "../../.."   },
        {"../../../..", "../../../.."},
        {"../../../a",  "../../../a" },
        {"../../a/",    "../../a"    },
        {"../../a/.",   "../../a"    },
        {"../../a/..",  "../.."      },
        {"../../a/b",   "../../a/b"  },
        {"../a//",      "../a"       },
        {"../a//.",     "../a"       },
        {"../a//..",    ".."         },
        {"../a//b",     "../a/b"     },
        {"../a/./",     "../a"       },
        {"../a/./.",    "../a"       },
        {"../a/./..",   ".."         },
        {"../a/./b",    "../a/b"     },
        {"../a/../",    ".."         },
        {"../a/../.",   ".."         },
        {"../a/../..",  "../.."      },
        {"../a/../b",   "../b"       },
        {"../a/b/",     "../a/b"     },
        {"../a/b/.",    "../a/b"     },
        {"../a/b/..",   "../a"       },
        {"../a/b/c",    "../a/b/c"   },
        {"a///",        "a"          },
        {"a///.",       "a"          },
        {"a///..",      "."          },
        {"a///b",       "a/b"        },
        {"a//./",       "a"          },
        {"a//./.",      "a"          },
        {"a//./..",     "."          },
        {"a//./b",      "a/b"        },
        {"a//../",      "."          },
        {"a//../.",     "."          },
        {"a//../..",    ".."         },
        {"a//../b",     "b"          },
        {"a//b/",       "a/b"        },
        {"a//b/.",      "a/b"        },
        {"a//b/..",     "a"          },
        {"a//b/c",      "a/b/c"      },
        {"a/.//",       "a"          },
        {"a/.//.",      "a"          },
        {"a/.//..",     "."          },
        {"a/.//b",      "a/b"        },
        {"a/././",      "a"          },
        {"a/././.",     "a"          },
        {"a/././..",    "."          },
        {"a/././b",     "a/b"        },
        {"a/./../",     "."          },
        {"a/./../.",    "."          },
        {"a/./../..",   ".."         },
        {"a/./../b",    "b"          },
        {"a/./b/",      "a/b"        },
        {"a/./b/.",     "a/b"        },
        {"a/./b/..",    "a"          },
        {"a/./b/c",     "a/b/c"      },
        {"a/..//",      "."          },
        {"a/..//.",     "."          },
        {"a/..//..",    ".."         },
        {"a/..//b",     "b"          },
        {"a/.././",     "."          },
        {"a/.././.",    "."          },
        {"a/.././..",   ".."         },
        {"a/.././b",    "b"          },
        {"a/../../",    ".."         },
        {"a/../../.",   ".."         },
        {"a/../../..",  "../.."      },
        {"a/../../b",   "../b"       },
        {"a/../b/",     "b"          },
        {"a/../b/.",    "b"          },
        {"a/../b/..",   "."          },
        {"a/../b/c",    "b/c"        },
        {"a/b//",       "a/b"        },
        {"a/b//.",      "a/b"        },
        {"a/b//..",     "a"          },
        {"a/b//c",      "a/b/c"      },
        {"a/b/./",      "a/b"        },
        {"a/b/./.",     "a/b"        },
        {"a/b/./..",    "a"          },
        {"a/b/./c",     "a/b/c"      },
        {"a/b/../",     "a"          },
        {"a/b/../.",    "a"          },
        {"a/b/../..",   "."          },
        {"a/b/../c",    "a/c"        },
        {"a/b/c/",      "a/b/c"      },
        {"a/b/c/.",     "a/b/c"      },
        {"a/b/c/..",    "a/b"        },
        {"a/b/c/d",     "a/b/c/d"    },
        {"C:/a/b/c",    "C:/a/b/c"   },
        {"a/b/c.ext",   "a/b/c.ext"  },
    };

    for (auto test : cases) {
        test.path     = paths::platform_path(test.path);
        test.expected = paths::platform_path(test.expected);
        EXPECT_EQ(paths::normpath(test.path), test.expected);
    }
};
