#include "../src/detect.hpp"
#include "../src/paths.hpp"
#include <algorithm>
#include <gtest/gtest.h>
#include <string>
#include <vector>

TEST(Paths_Paths, resolve) {
    GTEST_SKIP();

    struct TestCase {
        std::vector<std::string> paths;
        std::string              expected;
    };

    std::vector<TestCase> cases = {
        {{"."},              ""        },
        {{" "},              " "       },
        {{"."},              "."       },
        {{".."},             ".."      },
        {{"a"},              "a"       },
        {{"", ""},           "/"       },
        {{"", " "},          "/ "      },
        {{"", ""},           "/."      },
        {{"", ""},           "/.."     },
        {{"", "a"},          "/a"      },
        {{" "},              " /"      },
        {{" ", " "},         " / "     },
        {{" "},              " /."     },
        {{"."},              " /.."    },
        {{" ", "a"},         " /a"     },
        {{"."},              "./"      },
        {{" "},              "./ "     },
        {{"."},              "./."     },
        {{".."},             "./.."    },
        {{"a"},              "./a"     },
        {{".."},             "../"     },
        {{"..", " "},        "../ "    },
        {{".."},             "../."    },
        {{"..", ".."},       "../.."   },
        {{"..", "a"},        "../a"    },
        {{"a"},              "a/"      },
        {{"a", " "},         "a/ "     },
        {{"a"},              "a/."     },
        {{"."},              "a/.."    },
        {{"a", "a"},         "a/a"     },
        {{"", "", ""},       "//"      },
        {{"", "", " "},      "// "     },
        {{"", "", ""},       "//."     },
        {{"", "", ""},       "//.."    },
        {{"", "", "a"},      "//a"     },
        {{"", " "},          "/ /"     },
        {{"", " ", " "},     "/ / "    },
        {{"", " "},          "/ /."    },
        {{"", ""},           "/ /.."   },
        {{"", " ", "a"},     "/ /a"    },
        {{"", ""},           "/./"     },
        {{"", " "},          "/./ "    },
        {{"", ""},           "/./."    },
        {{"", ""},           "/./.."   },
        {{"", "a"},          "/./a"    },
        {{"", ""},           "/../"    },
        {{"", " "},          "/../ "   },
        {{"", ""},           "/../."   },
        {{"", ""},           "/../.."  },
        {{"", "a"},          "/../a"   },
        {{"", "a"},          "/a/"     },
        {{"", "a", " "},     "/a/ "    },
        {{"", "a"},          "/a/."    },
        {{"", ""},           "/a/.."   },
        {{"", "a", "a"},     "/a/a"    },
        {{" "},              " //"     },
        {{" ", " "},         " // "    },
        {{" "},              " //."    },
        {{"."},              " //.."   },
        {{" ", "a"},         " //a"    },
        {{" ", " "},         " / /"    },
        {{" ", " ", " "},    " / / "   },
        {{" ", " "},         " / /."   },
        {{" "},              " / /.."  },
        {{" ", " ", "a"},    " / /a"   },
        {{" "},              " /./"    },
        {{" ", " "},         " /./ "   },
        {{" "},              " /./."   },
        {{"."},              " /./.."  },
        {{" ", "a"},         " /./a"   },
        {{"."},              " /../"   },
        {{" "},              " /../ "  },
        {{"."},              " /../."  },
        {{".."},             " /../.." },
        {{"a"},              " /../a"  },
        {{" ", "a"},         " /a/"    },
        {{" ", "a", " "},    " /a/ "   },
        {{" ", "a"},         " /a/."   },
        {{" "},              " /a/.."  },
        {{" ", "a", "a"},    " /a/a"   },
        {{"."},              ".//"     },
        {{" "},              ".// "    },
        {{"."},              ".//."    },
        {{".."},             ".//.."   },
        {{"a"},              ".//a"    },
        {{" "},              "./ /"    },
        {{" ", " "},         "./ / "   },
        {{" "},              "./ /."   },
        {{"."},              "./ /.."  },
        {{" ", "a"},         "./ /a"   },
        {{"."},              "././"    },
        {{" "},              "././ "   },
        {{"."},              "././."   },
        {{".."},             "././.."  },
        {{"a"},              "././a"   },
        {{".."},             "./../"   },
        {{"..", " "},        "./../ "  },
        {{".."},             "./../."  },
        {{"..", ".."},       "./../.." },
        {{"..", "a"},        "./../a"  },
        {{"a"},              "./a/"    },
        {{"a", " "},         "./a/ "   },
        {{"a"},              "./a/."   },
        {{"."},              "./a/.."  },
        {{"a", "a"},         "./a/a"   },
        {{".."},             "..//"    },
        {{"..", " "},        "..// "   },
        {{".."},             "..//."   },
        {{"..", ".."},       "..//.."  },
        {{"..", "a"},        "..//a"   },
        {{"..", " "},        "../ /"   },
        {{"..", " ", " "},   "../ / "  },
        {{"..", " "},        "../ /."  },
        {{".."},             "../ /.." },
        {{"..", " ", "a"},   "../ /a"  },
        {{".."},             ".././"   },
        {{"..", " "},        ".././ "  },
        {{".."},             ".././."  },
        {{"..", ".."},       ".././.." },
        {{"..", "a"},        ".././a"  },
        {{"..", ".."},       "../../"  },
        {{"..", "..", " "},  "../../ " },
        {{"..", ".."},       "../../." },
        {{"..", "..", ".."}, "../../.."},
        {{"..", "..", "a"},  "../../a" },
        {{"..", "a"},        "../a/"   },
        {{"..", "a", " "},   "../a/ "  },
        {{"..", "a"},        "../a/."  },
        {{".."},             "../a/.." },
        {{"..", "a", "a"},   "../a/a"  },
        {{"a"},              "a//"     },
        {{"a", " "},         "a// "    },
        {{"a"},              "a//."    },
        {{"."},              "a//.."   },
        {{"a", "a"},         "a//a"    },
        {{"a", " "},         "a/ /"    },
        {{"a", " ", " "},    "a/ / "   },
        {{"a", " "},         "a/ /."   },
        {{"a"},              "a/ /.."  },
        {{"a", " ", "a"},    "a/ /a"   },
        {{"a"},              "a/./"    },
        {{"a", " "},         "a/./ "   },
        {{"a"},              "a/./."   },
        {{"."},              "a/./.."  },
        {{"a", "a"},         "a/./a"   },
        {{"."},              "a/../"   },
        {{" "},              "a/../ "  },
        {{"."},              "a/../."  },
        {{".."},             "a/../.." },
        {{"a"},              "a/../a"  },
        {{"a", "a"},         "a/a/"    },
        {{"a", "a", " "},    "a/a/ "   },
        {{"a", "a"},         "a/a/."   },
        {{"a"},              "a/a/.."  },
        {{"a", "a", "a"},    "a/a/a"   },
    };

    for (const auto test : cases) {
        if (platform::sep == '\\') {
            std::replace(test.expected.begin(), test.expected.end(), '/', '\\');
        }

        EXPECT_EQ(paths::resolve(test.paths), test.expected);
    }
}
