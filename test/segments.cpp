#include "../src/detect.hpp"
#include "../src/paths.hpp"
#include <gtest/gtest.h>
#include <string>
#include <algorithm>
#include <vector>

TEST(Paths_Paths, segments) {
    GTEST_SKIP();

    struct TestCase {
        std::string              path;
        std::vector<std::string> expected;
    };

    std::vector<TestCase> cases = {
        {"",         {"."}             },
        {" ",        {" "}             },
        {".",        {"."}             },
        {"..",       {".."}            },
        {"a",        {"a"}             },
        {"/",        {"", ""}          },
        {"/ ",       {"", " "}         },
        {"/.",       {"", ""}          },
        {"/..",      {"", ""}          },
        {"/a",       {"", "a"}         },
        {" /",       {" "}             },
        {" / ",      {" ", " "}        },
        {" /.",      {" "}             },
        {" /..",     {"."}             },
        {" /a",      {" ", "a"}        },
        {"./",       {"."}             },
        {"./ ",      {" "}             },
        {"./.",      {"."}             },
        {"./..",     {".."}            },
        {"./a",      {"a"}             },
        {"../",      {".."}            },
        {"../ ",     {"..", " "}       },
        {"../.",     {".."}            },
        {"../..",    {"..", ".."}      },
        {"../a",     {"..", "a"}       },
        {"a/",       {"a"}             },
        {"a/ ",      {"a", " "}        },
        {"a/.",      {"a"}             },
        {"a/..",     {"."}             },
        {"a/a",      {"a", "a"}        },
        {"//",       {"", "", ""}      },
        {"// ",      {"", "", " "}     },
        {"//.",      {"", "", ""}      },
        {"//..",     {"", "", ""}      },
        {"//a",      {"", "", "a"}     },
        {"/ /",      {"", " "}         },
        {"/ / ",     {"", " ", " "}    },
        {"/ /.",     {"", " "}         },
        {"/ /..",    {"", ""}          },
        {"/ /a",     {"", " ", "a"}    },
        {"/./",      {"", ""}          },
        {"/./ ",     {"", " "}         },
        {"/./.",     {"", ""}          },
        {"/./..",    {"", ""}          },
        {"/./a",     {"", "a"}         },
        {"/../",     {"", ""}          },
        {"/../ ",    {"", " "}         },
        {"/../.",    {"", ""}          },
        {"/../..",   {"", ""}          },
        {"/../a",    {"", "a"}         },
        {"/a/",      {"", "a"}         },
        {"/a/ ",     {"", "a", " "}    },
        {"/a/.",     {"", "a"}         },
        {"/a/..",    {"", ""}          },
        {"/a/a",     {"", "a", "a"}    },
        {" //",      {" "}             },
        {" // ",     {" ", " "}        },
        {" //.",     {" "}             },
        {" //..",    {"."}             },
        {" //a",     {" ", "a"}        },
        {" / /",     {" ", " "}        },
        {" / / ",    {" ", " ", " "}   },
        {" / /.",    {" ", " "}        },
        {" / /..",   {" "}             },
        {" / /a",    {" ", " ", "a"}   },
        {" /./",     {" "}             },
        {" /./ ",    {" ", " "}        },
        {" /./.",    {" "}             },
        {" /./..",   {"."}             },
        {" /./a",    {" ", "a"}        },
        {" /../",    {"."}             },
        {" /../ ",   {" "}             },
        {" /../.",   {"."}             },
        {" /../..",  {".."}            },
        {" /../a",   {"a"}             },
        {" /a/",     {" ", "a"}        },
        {" /a/ ",    {" ", "a", " "}   },
        {" /a/.",    {" ", "a"}        },
        {" /a/..",   {" "}             },
        {" /a/a",    {" ", "a", "a"}   },
        {".//",      {"."}             },
        {".// ",     {" "}             },
        {".//.",     {"."}             },
        {".//..",    {".."}            },
        {".//a",     {"a"}             },
        {"./ /",     {" "}             },
        {"./ / ",    {" ", " "}        },
        {"./ /.",    {" "}             },
        {"./ /..",   {"."}             },
        {"./ /a",    {" ", "a"}        },
        {"././",     {"."}             },
        {"././ ",    {" "}             },
        {"././.",    {"."}             },
        {"././..",   {".."}            },
        {"././a",    {"a"}             },
        {"./../",    {".."}            },
        {"./../ ",   {"..", " "}       },
        {"./../.",   {".."}            },
        {"./../..",  {"..", ".."}      },
        {"./../a",   {"..", "a"}       },
        {"./a/",     {"a"}             },
        {"./a/ ",    {"a", " "}        },
        {"./a/.",    {"a"}             },
        {"./a/..",   {"."}             },
        {"./a/a",    {"a", "a"}        },
        {"..//",     {".."}            },
        {"..// ",    {"..", " "}       },
        {"..//.",    {".."}            },
        {"..//..",   {"..", ".."}      },
        {"..//a",    {"..", "a"}       },
        {"../ /",    {"..", " "}       },
        {"../ / ",   {"..", " ", " "}  },
        {"../ /.",   {"..", " "}       },
        {"../ /..",  {".."}            },
        {"../ /a",   {"..", " ", "a"}  },
        {".././",    {".."}            },
        {".././ ",   {"..", " "}       },
        {".././.",   {".."}            },
        {".././..",  {"..", ".."}      },
        {".././a",   {"..", "a"}       },
        {"../../",   {"..", ".."}      },
        {"../../ ",  {"..", "..", " "} },
        {"../../.",  {"..", ".."}      },
        {"../../..", {"..", "..", ".."}},
        {"../../a",  {"..", "..", "a"} },
        {"../a/",    {"..", "a"}       },
        {"../a/ ",   {"..", "a", " "}  },
        {"../a/.",   {"..", "a"}       },
        {"../a/..",  {".."}            },
        {"../a/a",   {"..", "a", "a"}  },
        {"a//",      {"a"}             },
        {"a// ",     {"a", " "}        },
        {"a//.",     {"a"}             },
        {"a//..",    {"."}             },
        {"a//a",     {"a", "a"}        },
        {"a/ /",     {"a", " "}        },
        {"a/ / ",    {"a", " ", " "}   },
        {"a/ /.",    {"a", " "}        },
        {"a/ /..",   {"a"}             },
        {"a/ /a",    {"a", " ", "a"}   },
        {"a/./",     {"a"}             },
        {"a/./ ",    {"a", " "}        },
        {"a/./.",    {"a"}             },
        {"a/./..",   {"."}             },
        {"a/./a",    {"a", "a"}        },
        {"a/../",    {"."}             },
        {"a/../ ",   {" "}             },
        {"a/../.",   {"."}             },
        {"a/../..",  {".."}            },
        {"a/../a",   {"a"}             },
        {"a/a/",     {"a", "a"}        },
        {"a/a/ ",    {"a", "a", " "}   },
        {"a/a/.",    {"a", "a"}        },
        {"a/a/..",   {"a"}             },
        {"a/a/a",    {"a", "a", "a"}   },
    };

    for (const auto test : cases) {
        if (platform::sep == '\\') {
            std::replace(test.path.begin(), test.path.end(), '/', '\\');
        }

        EXPECT_EQ(paths::segments(test.path), test.expected);
    }
}
